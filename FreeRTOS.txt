**Pseudo Code for Nucleo Threads**

=========================
Nucleo 2 Threads - sensor hub and motor control
========================

Poll sensors
    Scan rs 485 bus 
        Read from scale
        Read from inclinometer
    Read analog inputs
        update from rotary encoder position
        Read from limit switches
        Read from motor current sensors

Update motor speed
    read current motor speed 
    calculate new motor_1,3 speed
        bar requested position
        current position
        speed limits
        inclinometer data
        PID update

    Calculate motor_2 speed
        bar requested position
        current position
        speed limits
        Scale weight
        PID update

    is motor speed valid?
    is motor speed within limits?


Update motor direction

Safety 
    is motors drawing too much current?
    is any of 3 limit switch pressed?
    is rotary encoder position valid and changing?
    Error code - feedback to Nucleo

Rotary encoder
    interrupts update position
    copy new position to old position
    update new position 

**Variables** In modbus holding registers/ coils?
    unsigned int|| current motor_X speed 
    bool        || current motor_X direction
    signed int  || current position of bar/rotary encoder
    unsigned int|| requested position of bar/rotary encoder
    signed int  || inclinometer data
    unsigned int|| weight load on scale
    unsigned int|| default bar position
    bool        || sensor_X replied 
    bool        || Recalibrate weight




========================
Nucleo 1 Threads - Display and RS485 Modbus master
========================
Display data
    top, down, and service posion GUI buttons
    Diagnostic button and menu    
        Display current motor speed
        Display current motor direction
        Display current position of rotary encoder
        Display inclinometer data
        Display weight load on scale
        set new default bar position
            Set current position to default
        Recalibrate weight
        Zero inclinometer


Request data from slaves/ send requested position
    Request all sensor data from Nucleo 2
        update at 2Hz

Receive data from slave
    Receive from rs 485
    
 
